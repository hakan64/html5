<canvas id="canvas" tabindex="1" width="200" height="300"></canvas>
<style>
body
{
background-color:#000000;
}
</style>
<!--<script type="text/javascript" src="html5tris.js"></script>-->
<script type="text/javascript">
var c=2,d=[[1,1,1,1,1],[1,1,1,c,1],[1,c,c,c,1],[1,1,1,1,1],[1,1,1,1,1]],g=[[1,1,1,1,1],[1,1,c,1,1],[1,c,c,c,1],[1,1,1,1,1],[1,1,1,1,1]],h=[[1,1,1,1,1],[1,1,1,1,1],[1,c,c,1,1],[1,1,c,c,1],[1,1,1,1,1]],j=[[1,1,1,1,1],[1,1,1,1,1],[1,1,c,c,1],[1,c,c,1,1],[1,1,1,1,1]],k=[[1,1,1,1,1],[1,c,1,1,1],[1,c,c,c,1],[1,1,1,1,1],[1,1,1,1,1]],l=[[1,1,1,1,1],[1,1,1,1,1],[1,1,c,c,1],[1,1,c,c,1],[1,1,1,1,1]],m=[[1,1,1,1,1],[1,1,1,1,1],[c,c,c,c,c],[1,1,1,1,1],[1,1,1,1,1]],n,p,q,r,s=Math.round(255*Math.random()),t=Math.round(255* Math.random()),u=Math.round(255*Math.random()),v=Math.round(255*Math.random()),w=Math.round(255*Math.random()),x=Math.round(255*Math.random()),y,z,A,B,C,D,E,F,G,H,I,J;function K(){switch(Math.round(100*Math.random())%7){case 0:return d;case 1:return g;case 2:return h;case 3:return j;case 4:return k;case 5:return l;case 6:return m}}function L(){q=r;r=K();s=v;t=w;u=x;v=Math.round(255*Math.random());w=Math.round(255*Math.random());x=Math.round(255*Math.random());y=Math.floor(I/3);z=0;E=!0} function M(b,a){for(var e=0;5>e;e++)for(var f=0;5>f;f++)if(q[e][f]==c&&0!=A[e+y+b][f+z+a].c&&0!=A[e+y+b][f+z+a].b&&0!=A[e+y+b][f+z+a].a)return!0;return!1}function N(){for(var b=0;5>b;b++)for(var a=0;5>a;a++)q[b][a]==c&&(A[b+y][a+z].c=s,A[b+y][a+z].b=t,A[b+y][a+z].a=u)} function O(){for(var b=J-2,a=J-2;0<=a;){for(var e=!0,f=1;f<I-1;f++)if(0==A[f][a].c&&0==A[f][a].b&&0==A[f][a].a){e=!1;break}if(e)B+=7,D++,10==D&&(D=0),a--;else{if(b!=a)for(f=1;f<I-1;f++)A[f][b].c=A[f][a].c,A[f][b].b=A[f][a].b,A[f][b].a=A[f][a].a;a--;b--}}for(;0<=b;){for(f=1;f<I-1;f++)A[f][b].c=0,A[f][b].b=0,A[f][b].a=0;b--}} function P(){p.fillStyle="black";p.fillRect(0,0,F,G);for(var b=0;b<J;b++)for(var a=0;a<I;a++)p.beginPath(),p.fillStyle="rgba("+A[a][b].c+","+A[a][b].b+","+A[a][b].a+",1)",p.fillRect(a*H,b*H,H,H);for(b=z;!M(0,1);)z++;for(a=0;5>a;a++)for(var e=0;5>e;e++)q[a][e]==c&&(p.beginPath(),p.fillStyle="rgba(34,34,34,1)",p.fillRect((a+y)*H,(e+z)*H,H,H));z=b;for(b=0;5>b;b++)for(a=0;5>a;a++)q[b][a]==c&&(p.beginPath(),p.fillStyle="rgba("+s+","+t+","+u+",1)",p.fillRect((b+y)*H,(a+z)*H,H,H));for(b=0;5>b;b++)for(a= 0;5>a;a++)r[b][a]==c&&(p.beginPath(),p.fillStyle="rgba("+v+","+w+","+x+",1)",p.fillRect((b+I)*H,a*H,H,H));p.fillStyle="white";p.font="bold "+H+"px Arial";p.fillText("Score: "+B,H,H)}function Q(){M(0,1)?(N(),L(),O(),E&&C++,3<C&&(alert("Game Over! Score: "+B),R())):(z++,E&&(E=!1));P()} function R(){r=K();v=Math.round(255*Math.random());w=Math.round(255*Math.random());x=Math.round(255*Math.random());L();A=Array(J);for(var b=0;b<J;b++)A[b]=Array(I);for(b=0;b<J-1;b++)for(var a=0;a<I;a++)0==a||a==I-1?(A[a][b]={},A[a][b].c=85,A[a][b].b=85,A[a][b].a=85):(A[a][b]={},A[a][b].c=0,A[a][b].b=0,A[a][b].a=0);for(a=0;a<I;a++)A[a][b]={},A[a][b].c=85,A[a][b].b=85,A[a][b].a=85;C=B=0;E=!1} function S(b){switch(b.keyCode){case 37:M(-1,0)||y--;P();break;case 38:b=[];for(var a=0;5>a;a++)b[a]=[];for(a=0;5>a;a++)for(var e=0;5>e;e++)b[a][e]=q[a][e];for(a=0;5>a;a++)for(e=0;5>e;e++)q[a][e]=b[4-e][a];if(M(0,0))for(a=0;5>a;a++)for(e=0;5>e;e++)q[a][e]=b[a][e];P();break;case 39:M(1,0)||y++;P();break;case 40:for(;!M(0,1);)z++;N();L();O();P()}} window.onload=function(){n=document.getElementById("canvas");n.focus();p=n.getContext("2d");F=n.width;G=n.height;H=10;I=F/H-5;J=G/H;R();n.addEventListener("keypress",S,!0);setInterval(Q,500)};
</script>
